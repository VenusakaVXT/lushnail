<!-- Feedback/Testimonials Section -->
<section class="relative w-full bg-black py-12 sm:py-16 lg:py-20 overflow-hidden" data-name="feedback">
    <!-- Background Image -->
    <div class="absolute inset-0 z-0">
        <img src="../../../../assets/images/BN3.jpg" alt="Background" class="w-full h-full object-cover" />
    </div>

    <div class="container mx-auto px-4 sm:px-6 lg:px-[3rem] relative z-10">
        <!-- Header -->
        <div class="text-center mb-10 sm:mb-12 lg:mb-16">
            <p class="sub-title-section">
                VÌ SAO NÊN CHỌN CHÚNG TÔI?
            </p>
            <h2 class="title-section text-primary">
                CẢM NHẬN HỌC VIÊN
            </h2>
            <p
                class="font-fz-poppins text-white text-[14px] sm:text-[15px] md:text-[16px] leading-relaxed max-w-2xl mx-auto">
                Những chia sẻ chân thật từ học viên đã tin tưởng và đồng hành cùng chúng tôi
            </p>
        </div>

        <!-- Testimonials Slider -->
        <div class="blaze-slider bslider-feedback-testimonials section_testimonials max-w-6xl mx-auto"
            id="feedback-slider">
            <!-- Navigation Buttons -->
            <button class="blaze-prev" aria-label="Previous slide">
                <i data-lucide="chevron-left"></i>
            </button>
            <button class="blaze-next" aria-label="Next slide">
                <i data-lucide="chevron-right"></i>
            </button>

            <div class="blaze-container">
                <div class="blaze-track-container">
                    <div class="blaze-track">
                        <!-- Testimonial 1 -->
                        <div class="blaze-slide">
                            <div
                                class="testimonial-card bg-[#1a1a1a] rounded-2xl p-6 sm:p-8 border border-[#DDB657] transition-all duration-500 relative">
                                <!-- Quote Icon - Top Right -->
                                <div class="absolute top-4 right-4 sm:top-6 sm:right-6">
                                    <img src="/assets/images/qoute.png" alt="Quote" class="w-5 h-5 object-contain">
                                </div>
                                <div class="flex items-start gap-4 mb-4">
                                    <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=200&auto=format&fit=crop"
                                        alt="Huyền Trang"
                                        class="w-12 h-12 rounded-full object-cover flex-shrink-0" />
                                    <div class="flex-1">
                                        <h3
                                            class=" text-white text-[16px] sm:text-[18px] mb-1 font-playfair ">
                                            Huyền Trang
                                        </h3>
                                        <p class="font-fz-poppins text-primary text-sm uppercase">
                                            CHỦ TIỆM NAILS
                                        </p>
                                    </div>
                                </div>

                                <!-- Star Rating -->
                                <div class="flex items-center gap-1 mb-4">
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                </div>

                                <!-- Testimonial Text with Golden Quote -->
                                <div class="relative">
                                   
                                    <p
                                        class="font-fz-poppins text-white text-[14px] sm:text-[15px] md:text-[16px] leading-relaxed relative z-10 ">
                                        Tôi đã từng học ở nhiều nơi nhưng chỉ khi đến đây tôi mới thực sự hiểu thế nào
                                        là nghệ thuật Nail đỉnh cao. Giáo trình rất sát thực tế, không giấu nghề.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Testimonial 2 -->
                        <div class="blaze-slide">
                            <div
                                class="testimonial-card bg-[#1a1a1a] rounded-2xl p-6 sm:p-8 border border-[#DDB657] transition-all duration-500 relative">
                                <!-- Quote Icon - Top Right -->
                                <div class="absolute top-4 right-4 sm:top-6 sm:right-6">
                                    <img src="/assets/images/qoute.png" alt="Quote" class="w-5 h-5 object-contain">
                                </div>
                                <div class="flex items-start gap-4 mb-4">
                                    <img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&auto=format&fit=crop"
                                        alt="Ngọc Anh"
                                        class="w-12 h-12  rounded-full object-cover flex-shrink-0" />
                                    <div class="flex-1">
                                        <h3
                                            class=" text-white text-[16px] sm:text-[18px] mb-1 font-playfair ">
                                            Ngọc Anh
                                        </h3>
                                        <p class="font-fz-poppins text-primary text-sm uppercase">
                                            HỌC VIÊN
                                        </p>
                                    </div>
                                </div>

                                <!-- Star Rating -->
                                <div class="flex items-center gap-1 mb-4">
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                </div>

                                <!-- Testimonial Text with Golden Quote -->
                                <div class="relative">
                                   
                                    <p
                                        class="font-fz-poppins text-white text-[14px] sm:text-[15px] md:text-[16px] leading-relaxed relative z-10 ">
                                        Khóa học rất chi tiết và dễ hiểu. Giảng viên hỗ trợ tận tình, mình đã tự tin mở
                                        salon riêng sau khi hoàn thành khóa học.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Testimonial 3 -->
                        <div class="blaze-slide">
                            <div
                                class="testimonial-card bg-[#1a1a1a] rounded-2xl p-6 sm:p-8 border border-[#DDB657] transition-all duration-500 relative">
                                <!-- Quote Icon - Top Right -->
                                <div class="absolute top-4 right-4 sm:top-6 sm:right-6">
                                    <img src="/assets/images/qoute.png" alt="Quote" class="w-5 h-5 object-contain">
                                </div>
                                <div class="flex items-start gap-4 mb-4">
                                    <img src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=200&auto=format&fit=crop"
                                        alt="Mai Linh"
                                        class="w-12 h-12 rounded-full object-cover flex-shrink-0" />
                                    <div class="flex-1">
                                        <h3
                                            class=" text-white text-[16px] sm:text-[18px] mb-1 font-playfair ">
                                            Mai Linh
                                        </h3>
                                        <p class="font-fz-poppins text-primary text-sm uppercase">
                                            THỢ NAIL CHUYÊN NGHIỆP
                                        </p>
                                    </div>
                                </div>

                                <!-- Star Rating -->
                                <div class="flex items-center gap-1 mb-4">
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                </div>

                                <!-- Testimonial Text with Golden Quote -->
                                <div class="relative">
                                   
                                    <p
                                        class="font-fz-poppins text-white text-[14px] sm:text-[15px] md:text-[16px] leading-relaxed relative z-10 ">
                                        Mình đã học được rất nhiều kỹ thuật nâng cao từ khóa học này. Chất lượng giảng
                                        dạy tuyệt vời, giáo trình rõ ràng và thực hành nhiều.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Testimonial 4 -->
                        <div class="blaze-slide">
                            <div
                                class="testimonial-card bg-[#1a1a1a] rounded-2xl p-6 sm:p-8 border border-[#DDB657] transition-all duration-500 relative">
                                <!-- Quote Icon - Top Right -->
                                <div class="absolute top-4 right-4 sm:top-6 sm:right-6">
                                    <img src="/assets/images/qoute.png" alt="Quote" class="w-5 h-5 object-contain">
                                </div>
                                <div class="flex items-start gap-4 mb-4">
                                    <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&auto=format&fit=crop"
                                        alt="Thanh Hương"
                                        class="w-12 h-12 rounded-full object-cover flex-shrink-0" />
                                    <div class="flex-1">
                                        <h3
                                            class=" text-white text-[16px] sm:text-[18px] mb-1 font-playfair ">
                                            Thanh Hương
                                        </h3>
                                        <p class="font-fz-poppins text-primary text-sm uppercase">
                                            HỌC VIÊN
                                        </p>
                                    </div>
                                </div>

                                <!-- Star Rating -->
                                <div class="flex items-center gap-1 mb-4">
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                    <i data-lucide="star"
                                        class="w-4 h-4 sm:w-5 sm:h-5 text-primary fill-[#DDB657]"></i>
                                </div>

                                <!-- Testimonial Text with Golden Quote -->
                                <div class="relative">
                                   
                                    <p
                                        class="font-fz-poppins text-white text-[14px] sm:text-[15px] md:text-[16px] leading-relaxed relative z-10 ">
                                        Giáo viên rất tận tâm và chuyên nghiệp. Mình học được không chỉ kỹ thuật mà còn
                                        cả cách giao tiếp với khách hàng. Khóa học thực sự đáng giá!
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pagination Dots -->
            <div class="blaze-pagination"></div>
        </div>
    </div>
</section>

<style>
    /* Ensure only 3 slides are shown on desktop */
    .section_testimonials.blaze-slider {
        --slides-to-show: 1;
    }

    @media (min-width: 600px) and (max-width: 1023px) {
        .section_testimonials.blaze-slider {
            --slides-to-show: 2;
        }
    }

    @media (min-width: 1023px) {
        .section_testimonials.blaze-slider {
            --slides-to-show: 3;
        }
    }

    /* Custom styles for testimonials slider navigation buttons */
    .section_testimonials .blaze-prev,
    .section_testimonials .blaze-next {
        background-color: #DDB657 !important;
        color: #fff !important;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        align-items: center;
        justify-content: center;
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        z-index: 20;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .section_testimonials .blaze-prev i,
    .section_testimonials .blaze-next i {
        color: #fff;
        stroke-width: 2.5;
    }

    .section_testimonials .blaze-prev {
        left: -60px;
    }

    .section_testimonials .blaze-next {
        right: -60px;
    }

    @media (min-width: 1024px) {

        .section_testimonials .blaze-prev,
        .section_testimonials .blaze-next {
            display: flex;
        }
    }

    .section_testimonials .blaze-prev:hover,
    .section_testimonials .blaze-next:hover {
        background-color: #F4DB89;
        transform: translateY(-50%) scale(1.1);
    }

    @media (max-width: 1024px) {
        .section_testimonials .blaze-prev {
            left: -40px;
        }

        .section_testimonials .blaze-next {
            right: -40px;
        }
    }

    @media (max-width: 768px) {
        .section_testimonials .blaze-prev {
            left: 8px;
        }

        .section_testimonials .blaze-next {
            right: 8px;
        }
    }

    /* Pagination dots styling */
    .section_testimonials .blaze-pagination {
        display: flex !important;
        justify-content: center;
        gap: 10px;
        margin-top: 32px;
        padding: 0;
    }

    .section_testimonials .blaze-pagination button {
        background-color: #000 !important;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        border: 2px solid #fff !important;
        cursor: pointer;
        transition: all 0.3s ease;
        padding: 0;
        position: relative;
    }

    .section_testimonials .blaze-pagination button.active {
        background-color: #DDB657 !important;
        width: 12px;
        height: 12px;
        border: 2px solid #000;
    }

    /* Testimonial card styles - active state */
    .testimonial-card {
        transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        transform: scale(1) translateY(0);
        opacity: 1;
        min-height: auto;
        border-width: 1px;
        border-color: rgba(255, 255, 255, 0.2);
    }

    .testimonial-card.active {
        border-width: 1px;
        border-color: #DDB657;
        transform: translateY(-15px);
        opacity: 1;
        box-shadow: 0 8px 24px rgba(221, 182, 87, 0.3);
        min-height: 100%;
    }

    /* Smooth transition for blaze track */
    .section_testimonials .blaze-track {
        transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        will-change: transform;
    }

    /* Ensure container has relative positioning for navigation buttons */
    .section_testimonials .blaze-container {
        position: relative;
        padding-top: 30px;
        padding-bottom: 20px;
        overflow-y: visible;
        overflow-x: hidden;
    }

    /* Ensure track container allows overflow for elevated active slide */
    .section_testimonials .blaze-track-container {
        overflow: visible !important;
        margin-top: 0;
        margin-bottom: 0;
    }

    /* Ensure slider wrapper allows overflow */
    .section_testimonials.blaze-slider {
        overflow: visible !important;
    }

    /* Ensure slides have equal height */
    .section_testimonials .blaze-slide {
        display: flex;
        align-items: stretch;
    }

    .section_testimonials .blaze-slide>div {
        width: 100%;
        display: flex;
        flex-direction: column;
    }
</style>

<script>
    // Update active slide styling
    document.addEventListener('DOMContentLoaded', function () {
        const slider = document.getElementById('feedback-slider');
        if (!slider) return;

        // Wait for BlazeSlider to initialize
        setTimeout(function () {
            const blazeInstance = slider.blazeSlider;
            if (!blazeInstance) {
                // Retry after a bit more time
                setTimeout(arguments.callee, 200);
                return;
            }

            function updateActiveSlide() {
                const slides = slider.querySelectorAll('.blaze-slide');
                if (slides.length === 0) return;

                const slidesToShow = window.innerWidth >= 1023 ? 3 : (window.innerWidth >= 600 ? 2 : 1);
                const track = slider.querySelector('.blaze-track');
                const trackContainer = slider.querySelector('.blaze-track-container');

                if (!track || !trackContainer) return;

                // Get track transform to calculate which slides are visible
                const trackRect = track.getBoundingClientRect();
                const containerRect = trackContainer.getBoundingClientRect();
                const containerCenter = containerRect.left + containerRect.width / 2;

                // Find which slide is closest to center
                let closestSlideIndex = -1;
                let closestDistance = Infinity;

                slides.forEach(function (slide, index) {
                    const slideRect = slide.getBoundingClientRect();
                    const slideCenter = slideRect.left + slideRect.width / 2;
                    const distance = Math.abs(slideCenter - containerCenter);

                    // Check if slide is at least 50% visible
                    const slideLeft = slideRect.left;
                    const slideRight = slideRect.right;
                    const containerLeft = containerRect.left;
                    const containerRight = containerRect.right;

                    const visibleWidth = Math.min(slideRight, containerRight) - Math.max(slideLeft, containerLeft);
                    const slideWidth = slideRect.width;
                    const visibilityRatio = visibleWidth / slideWidth;

                    if (visibilityRatio >= 0.5 && distance < closestDistance) {
                        closestDistance = distance;
                        closestSlideIndex = index;
                    }
                });

                // If we found a center slide, use it
                // Otherwise, calculate based on visible slides
                let activeIndex;

                if (closestSlideIndex !== -1 && slidesToShow === 3) {
                    // For 3 slides, we want the middle one
                    // Find all visible slides and get the middle one
                    const visibleSlides = [];
                    slides.forEach(function (slide, index) {
                        const slideRect = slide.getBoundingClientRect();
                        const slideLeft = slideRect.left;
                        const slideRight = slideRect.right;
                        const containerLeft = containerRect.left;
                        const containerRight = containerRect.right;

                        const visibleWidth = Math.min(slideRight, containerRight) - Math.max(slideLeft, containerLeft);
                        const slideWidth = slideRect.width;
                        const visibilityRatio = visibleWidth / slideWidth;

                        if (visibilityRatio >= 0.3) {
                            visibleSlides.push(index);
                        }
                    });

                    if (visibleSlides.length >= 3) {
                        // Sort and get middle slide
                        visibleSlides.sort(function (a, b) { return a - b; });
                        activeIndex = visibleSlides[1]; // 2nd position (middle of 3)
                    } else if (visibleSlides.length === 2) {
                        activeIndex = visibleSlides[0];
                    } else if (visibleSlides.length === 1) {
                        activeIndex = visibleSlides[0];
                    } else {
                        // Fallback to closest
                        activeIndex = closestSlideIndex;
                    }
                } else if (closestSlideIndex !== -1) {
                    activeIndex = closestSlideIndex;
                } else {
                    // Fallback: use state-based calculation
                    const state = blazeInstance.states && blazeInstance.states[blazeInstance.stateIndex];
                    if (state && state.page) {
                        const firstSlideIndex = state.page[0];
                        activeIndex = slidesToShow === 3 ? (firstSlideIndex + 1) : firstSlideIndex;
                    } else {
                        return;
                    }
                }

                // Ensure activeIndex is within valid range
                if (activeIndex < 0 || activeIndex >= slides.length) {
                    return;
                }

                // Update active state
                slides.forEach(function (slide, index) {
                    const card = slide.querySelector('.testimonial-card');
                    if (!card) return;

                    if (index === activeIndex) {
                        card.classList.add('active');
                    } else {
                        card.classList.remove('active');
                    }
                });
            }

            // Listen for slide changes
            if (blazeInstance.onSlide) {
                blazeInstance.onSlide(function (stateIndex, firstSlideIndex, lastSlideIndex) {
                    // Update after transition completes
                    setTimeout(function () {
                        updateActiveSlide();
                    }, 300);
                });
            }

            // Initial update
            setTimeout(function () {
                updateActiveSlide();
            }, 500);

            // Update on navigation button clicks
            const prevBtn = slider.querySelector('.blaze-prev');
            const nextBtn = slider.querySelector('.blaze-next');

            if (prevBtn) {
                prevBtn.addEventListener('click', function () {
                    setTimeout(function () {
                        updateActiveSlide();
                    }, 300);
                });
            }

            if (nextBtn) {
                nextBtn.addEventListener('click', function () {
                    setTimeout(function () {
                        updateActiveSlide();
                    }, 300);
                });
            }

            // Update on pagination clicks
            const paginationButtons = slider.querySelectorAll('.blaze-pagination button');
            paginationButtons.forEach(function (btn) {
                btn.addEventListener('click', function () {
                    setTimeout(function () {
                        updateActiveSlide();
                    }, 300);
                });
            });

            // Update on window resize
            let resizeTimer;
            window.addEventListener('resize', function () {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function () {
                    updateActiveSlide();
                }, 200);
            });

            // Periodic update for autoplay
            setInterval(function () {
                updateActiveSlide();
            }, 500);

        }, 500);
    });
</script>